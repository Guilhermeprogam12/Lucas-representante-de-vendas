<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Lucas Vendas - Cat√°logo Premium</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: { DEFAULT: '#c7b158', dark: '#b39f4e', light: '#dcd09d' },
                        dark: '#2c2c2c'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Poppins', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #e2e8f0; color: #2c2c2c; overflow-x: hidden; touch-action: pan-y; }
        @media (max-width: 640px) { body { background-color: #fafafa; } }

        #app-wrapper {
            max-width: 480px; margin: 0 auto; min-height: 100vh;
            background-color: #fafafa; position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex; flex-direction: column;
        }

        #menu-screen { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        
        .collection-card {
            width: 100%; height: 140px; margin: 15px 0;
            background: white; border: 1px solid #eee; border-radius: 12px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; cursor: pointer; transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); position: relative; overflow: hidden;
        }
        .collection-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-color: #c7b158; }
        .collection-card::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 4px; background: #c7b158; transform: scaleX(0); transform-origin: left; transition: transform 0.3s ease; }
        .collection-card:hover::after { transform: scaleX(1); }
        .card-title { font-family: 'Poppins', sans-serif; font-weight: 700; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px; color: #2c2c2c; }
        .card-subtitle { font-size: 0.8rem; color: #888; letter-spacing: 2px; text-transform: uppercase; }

        #viewer-screen { display: none; height: 100vh; flex-direction: column; background: #f5f5f5; }
        #pdf-container { flex: 1; overflow-y: auto; overflow-x: hidden; display: flex; justify-content: center; align-items: flex-start; padding: 20px 0 80px 0; }
        canvas { box-shadow: 0 10px 30px rgba(0,0,0,0.08); max-width: 98%; height: auto !important; border-radius: 4px; background: white; }
        
        .controls { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; background: #ffffff; border-top: 1px solid #eee; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 40; box-shadow: 0 -5px 20px rgba(0,0,0,0.03); }
        .nav-btn { width: 45px; height: 45px; border-radius: 8px; border: 1px solid #eee; background: white; color: #555; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .nav-btn:active { background: #eee; }

        .cart-float { position: absolute; top: 85px; right: 20px; background: #c7b158; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; box-shadow: 0 5px 15px rgba(199, 177, 88, 0.4); z-index: 50; cursor: pointer; transition: transform 0.2s; }
        .cart-float:active { transform: scale(0.9); }
        .badge { position: absolute; top: -3px; right: -3px; background: #2c2c2c; color: white; font-size: 0.7rem; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 60; display: none; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
        .modal-box { background: #ffffff; width: 95%; max-width: 450px; max-height: 90vh; border-radius: 16px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        
        .input-gold { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 8px; outline: none; background: #f9f9f9; transition: all 0.2s; font-size: 0.9rem; }
        .input-gold:focus { border-color: #c7b158; background: white; }
        .label-gold { font-size: 0.7rem; font-weight: bold; text-transform: uppercase; color: #888; margin-bottom: 4px; display: block; margin-left: 2px; }
        
        /* Notifica√ß√£o Toast */
        .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #2c2c2c; color: white; padding: 10px 20px; border-radius: 50px; font-size: 0.9rem; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 70; }
        .toast.show { opacity: 1; }
    </style>
</head>
<body>

    <div id="app-wrapper">

        <div id="menu-screen">
            <div class="mb-10">
                <h1 class="font-heading text-4xl font-black tracking-tighter mb-2 text-dark">LUCAS <span class="text-gold">VENDAS</span></h1>
                <div class="h-1 w-20 bg-gold mx-auto mb-4"></div>
                <p class="text-gray-500 uppercase tracking-widest text-xs font-medium">Selecione sua cole√ß√£o</p>
            </div>

            <div class="collection-card" onclick="carregarCatalogo('MASCULINO')">
                <div><p class="card-subtitle">Cole√ß√£o</p><h2 class="card-title">Masculina</h2></div>
                <i class="fas fa-chevron-right text-gold"></i>
            </div>

            <div class="collection-card" onclick="carregarCatalogo('FEMININO')">
                <div><p class="card-subtitle">Cole√ß√£o</p><h2 class="card-title">Feminina</h2></div>
                <i class="fas fa-chevron-right text-gold"></i>
            </div>
            <div class="mt-12 text-sm text-gray-400 flex items-center gap-2"><i class="fab fa-whatsapp text-gold"></i> Atendimento: (16) 99142-0161</div>
        </div>

        <div id="viewer-screen">
            <header class="bg-white p-4 flex justify-between items-center shadow-sm z-50 relative border-b border-gray-100">
                <button onclick="voltarMenu()" class="text-gray-500 hover:text-gold px-2 flex items-center gap-2 font-medium text-sm transition"><i class="fas fa-arrow-left"></i> Voltar</button>
                <div class="text-center"><h2 id="cat-title" class="font-heading font-bold text-base tracking-widest text-dark uppercase">CAT√ÅLOGO</h2></div>
                <div class="w-16 text-right text-xs text-gray-400 font-medium"><span id="page-num" class="text-dark font-bold">1</span> / <span id="page-count">--</span></div>
            </header>

            <div id="btn-cart" class="cart-float hidden" onclick="abrirCarrinho()"><i class="fas fa-shopping-bag"></i><div id="cart-count" class="badge">0</div></div>
            
            <div id="pdf-container"><canvas id="the-canvas"></canvas></div>

            <div class="controls">
                <button onclick="mudarPagina(-1)" class="nav-btn"><i class="fas fa-chevron-left"></i></button>
                <button onclick="adicionarItem()" class="flex-1 mx-4 bg-gold hover:bg-gold-dark text-white h-12 rounded-lg font-heading font-bold text-sm shadow-md active:scale-95 transition flex items-center justify-center gap-3 uppercase tracking-wider"><i class="fas fa-plus"></i> Adicionar</button>
                <button onclick="mudarPagina(1)" class="nav-btn"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

    </div>

    <div id="loading" class="fixed inset-0 flex flex-col items-center justify-center bg-white z-[200] hidden">
        <i class="fas fa-circle-notch fa-spin text-4xl text-gold"></i>
        <p class="mt-4 text-gray-400 text-sm font-medium tracking-widest uppercase">Carregando...</p>
    </div>

    <div id="toast" class="toast">Item adicionado!</div>

    <div id="modal-carrinho" class="modal">
        <div class="modal-box">
            <div class="p-5 bg-white border-b border-gray-100 flex justify-between items-center">
                <h2 class="font-heading font-bold text-lg text-dark">Lista de Desejos</h2>
                <button onclick="fecharCarrinho()" class="text-gray-400 hover:text-dark transition"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div id="lista-itens" class="p-4 overflow-y-auto flex-1 space-y-3 max-h-[40vh] bg-gray-50"></div>
            <div class="p-5 bg-white border-t border-gray-100">
                <button onclick="abrirCheckout()" class="w-full bg-dark text-white py-4 rounded-xl font-heading font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition hover:bg-black">
                    Finalizar <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="modal-checkout" class="modal">
        <div class="modal-box h-full">
            <div class="p-4 bg-gold text-white flex justify-between items-center">
                <h2 class="font-heading font-bold text-lg">Seus Dados</h2>
                <button onclick="fecharCheckout()" class="text-white hover:text-gray-200"><i class="fas fa-times text-xl"></i></button>
            </div>
            <form id="form-pedido" onsubmit="enviarPedidoFinal(event)" class="p-6 overflow-y-auto flex-1 space-y-4">
                <div><label class="label-gold">Nome Completo</label><input type="text" id="nome" class="input-gold" placeholder="Seu nome" required></div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="label-gold">CPF</label><input type="text" id="cpf" class="input-gold" placeholder="000..." oninput="mascaraCPF(this)" required></div>
                    <div><label class="label-gold">WhatsApp</label><input type="tel" id="tel" class="input-gold" placeholder="(XX) 9..." oninput="mascaraTel(this)" required></div>
                </div>
                <div><label class="label-gold">Recado (Opcional)</label><input type="tel" id="tel2" class="input-gold" placeholder="(XX) 9..." oninput="mascaraTel(this)"></div>
                <div><label class="label-gold">Endere√ßo</label><input type="text" id="endereco" class="input-gold" placeholder="Rua, N√∫mero..." required></div>
                <div class="pt-4 border-t border-gray-100 mt-2">
                    <p class="text-xs font-bold text-gold uppercase mb-3">Dados da Empresa</p>
                    <div class="space-y-3">
                        <div><label class="label-gold">Nome da Empresa</label><input type="text" id="empresa" class="input-gold" placeholder="Onde trabalha?"></div>
                        <div><label class="label-gold">Endere√ßo da Empresa</label><input type="text" id="end_empresa" class="input-gold" placeholder="Endere√ßo comercial"></div>
                    </div>
                </div>
                <button type="submit" class="w-full bg-[#25D366] hover:bg-[#1ebc57] text-white py-4 rounded-xl font-heading font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition mt-4"><i class="fab fa-whatsapp text-2xl"></i> Enviar Pedido</button>
            </form>
        </div>
    </div>

    <script>
        // ========================================================
        // LINKS DO SUPABASE
        // ========================================================
        const URL_MASCULINO = 'https://eirzmdahrbcboqnvkvpk.supabase.co/storage/v1/object/public/catalogo/masculinos_compressed.pdf'; 
        const URL_FEMININO  = 'https://eirzmdahrbcboqnvkvpk.supabase.co/storage/v1/object/public/catalogo/Femininos_compressed.pdf'; 
        const ZAP_LUCAS = "5516991420161";
        // ========================================================

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        let pdfDoc = null, pageNum = 1, pageRendering = false, pageNumPending = null, catalogoAtual = '', carrinho = [];
        const canvas = document.getElementById('the-canvas'), ctx = canvas.getContext('2d');

        // --- SISTEMA DE LINK DIRETO (DEEP LINKING) ---
        window.onload = function() {
            // Verifica se tem par√¢metros na URL (ex: ?cat=MASCULINO&pag=450)
            const params = new URLSearchParams(window.location.search);
            const cat = params.get('cat');
            const pag = parseInt(params.get('pag'));

            if(cat && pag) {
                // Se tiver, carrega direto sem mostrar o menu
                carregarCatalogo(cat, pag);
            }
        }

        // --- PDF LOGIC ---
        function carregarCatalogo(tipo, paginaInicial = 1) {
            catalogoAtual = tipo;
            let url = (tipo === 'MASCULINO') ? URL_MASCULINO : URL_FEMININO;
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('viewer-screen').style.display = 'flex';
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('cat-title').innerText = `COLE√á√ÉO ${tipo}`;

            pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
                pdfDoc = pdfDoc_;
                document.getElementById('page-count').textContent = pdfDoc.numPages;
                pageNum = paginaInicial; // Usa a p√°gina do link ou come√ßa na 1
                renderPage(pageNum);
                document.getElementById('loading').classList.add('hidden');
            }).catch(function(error) {
                document.getElementById('loading').classList.add('hidden');
                alert("Erro ao carregar PDF."); voltarMenu();
            });
        }

        function voltarMenu() {
            // Limpa a URL para voltar ao "zero"
            window.history.pushState({}, document.title, window.location.pathname);
            pdfDoc = null;
            document.getElementById('viewer-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'flex';
        }

        function renderPage(num) {
            pageRendering = true;
            pdfDoc.getPage(num).then(function(page) {
                const containerWidth = document.getElementById('pdf-container').clientWidth;
                const viewport = page.getViewport({scale: 1});
                const scale = (containerWidth * 0.98) / viewport.width; 
                const scaledViewport = page.getViewport({scale: scale});
                canvas.height = scaledViewport.height; canvas.width = scaledViewport.width;
                const renderContext = { canvasContext: ctx, viewport: scaledViewport };
                page.render(renderContext).promise.then(function() {
                    pageRendering = false;
                    if (pageNumPending !== null) { renderPage(pageNumPending); pageNumPending = null; }
                });
            });
            document.getElementById('page-num').textContent = num;
        }

        function queueRenderPage(num) { if (pageRendering) pageNumPending = num; else renderPage(num); }
        function mudarPagina(dir) {
            if(dir === -1 && pageNum <= 1) return;
            if(dir === 1 && pageNum >= pdfDoc.numPages) return;
            pageNum += dir; queueRenderPage(pageNum);
        }

        window.addEventListener('resize', () => { if(pdfDoc) renderPage(pageNum); });

        // --- CART ---
        function adicionarItem() {
            const modalPrompt = document.createElement('div');
            modalPrompt.className = 'fixed inset-0 bg-black/50 z-[70] flex items-center justify-center p-4 backdrop-blur-sm';
            modalPrompt.innerHTML = `
                <div class="bg-white rounded-xl p-6 w-full max-w-sm shadow-2xl">
                    <h3 class="font-heading font-bold text-lg mb-2 text-dark">Adicionar Item</h3>
                    <p class="text-gray-600 text-sm mb-4">Item da <span class="font-bold text-gold">P√°gina ${pageNum}</span> (${catalogoAtual}).</p>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Alguma observa√ß√£o? (Tamanho/Cor)</label>
                    <input type="text" id="prompt-obs" class="w-full border border-gray-300 p-3 rounded-lg mb-4 outline-none focus:border-gold" placeholder="Ex: Tam 40...">
                    <div class="flex gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 py-3 rounded-lg border border-gray-300 font-medium text-gray-600">Cancelar</button>
                        <button onclick="confirmarAdicao()" class="flex-1 py-3 rounded-lg bg-gold text-white font-bold hover:bg-gold-dark shadow-md">Adicionar</button>
                    </div>
                </div>`;
            document.body.appendChild(modalPrompt);
            document.getElementById('prompt-obs').focus();

            window.confirmarAdicao = function() {
                const obs = document.getElementById('prompt-obs').value;
                carrinho.push({ catalogo: catalogoAtual, pagina: pageNum, obs: obs || "Padr√£o" });
                modalPrompt.remove(); atualizarCarrinhoUI();
                mostrarToast();
            };
        }

        function mostrarToast() {
            const t = document.getElementById('toast'); t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        function removerItem(index) { carrinho.splice(index, 1); atualizarCarrinhoUI(); if(carrinho.length === 0) fecharCarrinho(); }

        function atualizarCarrinhoUI() {
            const count = document.getElementById('cart-count'); const btn = document.getElementById('btn-cart');
            count.innerText = carrinho.length;
            if(carrinho.length > 0) btn.classList.remove('hidden'); else btn.classList.add('hidden');
            const lista = document.getElementById('lista-itens'); lista.innerHTML = '';
            carrinho.forEach((item, i) => {
                const badgeColor = item.catalogo === 'MASCULINO' ? 'bg-blue-100 text-blue-800' : 'bg-pink-100 text-pink-800';
                lista.innerHTML += `
                    <div class="flex justify-between items-center bg-white p-4 rounded-xl mb-2 border border-gray-100 shadow-sm">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[10px] ${badgeColor} px-2 py-0.5 rounded font-bold uppercase tracking-wider">${item.catalogo.substring(0, 4)}.</span>
                                <span class="font-heading font-bold text-dark text-sm">P√°gina ${item.pagina}</span>
                            </div>
                            <p class="text-xs text-gray-500 font-medium"><span class="text-gold">Obs:</span> ${item.obs}</p>
                        </div>
                        <button onclick="removerItem(${i})" class="text-gray-400 hover:text-red-500 p-2"><i class="fas fa-trash"></i></button>
                    </div>`;
            });
        }

        // --- CHECKOUT ---
        function abrirCarrinho() { document.getElementById('modal-carrinho').style.display = 'flex'; }
        function fecharCarrinho() { document.getElementById('modal-carrinho').style.display = 'none'; }
        function abrirCheckout() { document.getElementById('modal-carrinho').style.display = 'none'; document.getElementById('modal-checkout').style.display = 'flex'; }
        function fecharCheckout() { document.getElementById('modal-checkout').style.display = 'none'; document.getElementById('modal-carrinho').style.display = 'flex'; }

        function enviarPedidoFinal(e) {
            e.preventDefault();
            const nome = document.getElementById('nome').value;
            const cpf = document.getElementById('cpf').value;
            const tel = document.getElementById('tel').value;
            const tel2 = document.getElementById('tel2').value || "N√£o informado";
            const end = document.getElementById('endereco').value;
            const empresa = document.getElementById('empresa').value || "N√£o informado";
            const endEmpresa = document.getElementById('end_empresa').value || "N√£o informado";

            // Pega a URL base do site (para criar o link)
            const baseUrl = window.location.origin + window.location.pathname;

            let listaProdutos = "";
            carrinho.forEach(item => {
                // GERA O LINK M√ÅGICO
                const linkDireto = `${baseUrl}?cat=${item.catalogo}&pag=${item.pagina}`;
                listaProdutos += `üëü Cole√ß√£o ${item.catalogo} - P√°g ${item.pagina}\n   Obs: ${item.obs}\n   üîó Link: ${linkDireto}\n\n`;
            });

            const mensagem = `Ol√° Lucas, tudo bem? me chamo *${nome}*.\nE gostaria dos seguintes itens do cat√°logo:\n\n${listaProdutos}--------------------------------\n*MEUS DADOS:*\nüÜî CPF: ${cpf}\nüì± WhatsApp: ${tel}\nüìû Recado: ${tel2}\nüè† Endere√ßo: ${end}\n\n*DADOS DA EMPRESA:*\nüíº Empresa: ${empresa}\nüìç End. Empresa: ${endEmpresa}`;
            window.open(`https://wa.me/${ZAP_LUCAS}?text=${encodeURIComponent(mensagem)}`, '_blank');
        }

        function mascaraCPF(i){ let v=i.value.replace(/\D/g,""); v=v.replace(/(\d{3})(\d)/,"$1.$2"); v=v.replace(/(\d{3})(\d)/,"$1.$2"); v=v.replace(/(\d{3})(\d{1,2})$/,"$1-$2"); i.value=v; }
        function mascaraTel(i){ let v=i.value.replace(/\D/g,""); v=v.replace(/^(\d\d)(\d)/g,"($1) $2"); v=v.replace(/(\d{5})(\d)/,"$1-$2"); i.value=v; }
    </script>
</body>
</html>
